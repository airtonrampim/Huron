CONNECT DATABASE.FDB;

DROP TABLE Pedido_Produto;
DROP TABLE Pedido;
DROP TABLE Produto;
DROP TABLE Cliente;

CREATE TABLE Cliente(
	ID_Cliente INTEGER GENERATED BY DEFAULT AS IDENTITY,
	RazaoSocial VARCHAR(128) NOT NULL,
	NomeFantasia VARCHAR(128) NOT NULL,
	Email VARCHAR(128) NOT NULL,
	CNPJ CHAR(14) NOT NULL,
	Telefone VARCHAR(15) NOT NULL,
	Endereco VARCHAR(128) NOT NULL,
	Numero VARCHAR(5) NOT NULL,
	Bairro VARCHAR(128) NOT NULL,
	Complemento VARCHAR(128),
	Cidade VARCHAR(128) NOT NULL,
	Estado CHAR(2) NOT NULL,

	CONSTRAINT pk_Cliente
		PRIMARY KEY (ID_Cliente),
	CONSTRAINT uq_Cliente_CNPJ
		UNIQUE (CNPJ)
);

CREATE TABLE Produto (
	ID_Produto INTEGER GENERATED BY DEFAULT AS IDENTITY,
	Titulo VARCHAR(128) NOT NULL,
	Descricao VARCHAR(512) NOT NULL,
	Custo DECIMAL(10,2) NOT NULL,
	Preco DECIMAL(10,2) NOT NULL,

	CONSTRAINT pk_Produto
		PRIMARY KEY (ID_Produto)
);

CREATE TABLE Pedido (
	ID_Pedido INTEGER GENERATED BY DEFAULT AS IDENTITY,
	ID_Cliente INTEGER NOT NULL,

	CONSTRAINT pk_Pedido
		PRIMARY KEY (ID_Pedido),
	CONSTRAINT fk_Pedido_Cliente
		FOREIGN KEY (ID_Cliente)
		REFERENCES Cliente(ID_Cliente)
		ON DELETE CASCADE
);

CREATE TABLE Pedido_Produto (
	ID_Pedido INTEGER NOT NULL,
	ID_Produto INTEGER NOT NULL,
	Valor DECIMAL(10,2),
	Quantidade INTEGER NOT NULL,
	
	CONSTRAINT pk_Pedido_Produto
		PRIMARY KEY (ID_Pedido, ID_Produto),
	CONSTRAINT fk_Pedido_Produto_Pedido
		FOREIGN KEY (ID_Pedido)
		REFERENCES Pedido(ID_Pedido)
		ON DELETE CASCADE,
	CONSTRAINT fk_Pedido_Produto_Produto
		FOREIGN KEY (ID_Produto)
		REFERENCES Produto(ID_Produto)
		ON DELETE CASCADE
);
